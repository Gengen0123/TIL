# Dockerってなに？

Dockerは、アプリケーションをコンテナの中で動かすためのツール。
内部的にはLinuxの機能（名前空間・cgroups など）を利用している。

コンテナを作るためには、まず「イメージ」という設計図をビルドして作成する。
イメージを作るためのレシピファイルが Dockerfile。
Docker Hub には多くの公式イメージが用意されているが、
PHPの拡張モジュールを追加したい時や Nginx に独自設定を入れたい時など、
自分で設定を追加したい場合は、自作の Dockerfile を用意する必要がある。

---

### 開発環境
コードはMac側に保存するが、docker-compose.yml 内で volumes（ボリューム）を設定して
コンテナ内と同期させているため、修正した内容が即座に反映される。
これにより、コードを更新するたびにコンテナを再ビルドする必要がなく、確認がしやすい。

---

### 本番環境
実際にコンテナ内にコードを含めて動作させる必要があるため、
コンテナをビルドする段階でアプリのコードを一緒にイメージにコピーしておく。
コードを変更した場合は、その都度イメージを再ビルドして再デプロイする。

---

### docker-compose.yml とは
複数のコンテナ（PHP、MySQL、Nginx、phpMyAdminなど）が
どのように連携・通信するかを定義する「配線図」のような設定ファイル。
各コンテナの起動順序、使用するポート番号、マウントするフォルダ（volumes）、
環境変数、依存関係（depends_on）などをまとめて記述する。

---

### localhost とは
127.0.0.1 という特別なIPアドレスで、自分自身（このMac）を指す。
ネットワーク上には公開されておらず、PC内で完結する通信のために使われる。

---

### ポート番号とは
ポート番号は「どのプログラムに通信を届けるか」を区別するための番号。
主な例：
- SSH   → 22  
- HTTP  → 80  
- HTTPS → 443  
- MySQL → 3306  

---

### なぜ `http://localhost:8080` なのか

Mac本体とコンテナは、それぞれ独立した小さなコンピュータとして動いていると考える。
ブラウザからコンテナ内のWebサーバー（ApacheやNginx）にアクセスするには、
通信経路を docker-compose.yml で指定しておく必要がある。

Mac側ではすでに80番ポートなどがシステム用途で使われていることが多く、
さらに0〜1023番のポートは管理者権限が必要となる「特権ポート」である。
そのため、開発では自由に使える 8080 番ポートを選び、
docker-compose.yml に次のような設定を記述する：

Ports:
 "8080:80"

これにより、
「Macの8080番ポートに届いたHTTPリクエストを、
コンテナ内の80番ポート（Webサーバーが待ち受けている場所）へ転送する」
というルールができあがる。

---

### コンテナ間通信について

コンテナ同士の通信（例：PHP → MySQL）は、
Docker内部の仮想ネットワーク上で行われるため、
ホスト側（Mac）のポート番号は関係しない。
サービス名（例：`db`）をホスト名のように扱って接続できる。